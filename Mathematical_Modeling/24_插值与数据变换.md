# 插值模型的应用

常数插值：0 插值、均值插值、中位数插值等；

前向后向插值（对上一个或下一个非空数值的复制粘贴）需要在**时序数据**中用。

线性插值对两个点中的解析式是按照线性方程来建模。比如我们得到的原始数据列 $\{y\}$ 和数据下标 $\{x\}$，这里的数据下标 x 可能并不是固定频率的连续取值而是和 y 一样存在缺失。给定了数据点 $(x_k,\ y_k)$ 和 $(x_{k+1},\ y_{k+1})$，需要对两个点之间构造直线进行填充。显然，根据直线的点斜式方程，这个直线的解析式为：
$$
L_1(x) = y_k + \dfrac{y_{k+1} - y_k}{x_{k+1} - x_k}(x - x_k)
$$
三次样条插值是一种非常自然的插值方法。它将两个数据点之间的填充模式设置为三次多项式。它假设在数据点$(x_k,\ y_k)$ 和 $(x_{k+1},\ y_{k+1})$ 之间的三次式叫做 $l_k$ ，那么这一组三次式需要满足条件：
$$
\begin{cases}
a_ix_i^3 + b_ix_i^2 + c_ix_i + d_i = a_{i+1}x_{i+1}^3 + b_{i+1}x_{i+1}^2 + c_{i+1}x_{i+1} + d_{i+1} \\ 
3a_ix_i^2 + 2b_ix_i + c_i = 3a_{i+1}x_{i+1}^2 + 2b_{i+1}x_{i+1} + c_{i+1} \\
6a_ix_i + 2b_i = 6a_{i+1}x_{i+1} + 2b_{i+1}
\end{cases}
$$
通过解方程的形式可以解出每一只三次式。而简而言之，也就是说某个数据点前后两条三次函数不仅在当前的函数值相等，一次导数值和二次导数值也要保持相等。

拉格朗日插值：

对于一组数据 y 和下标 x，定义 n 个拉格朗日插值基函数：
$$
l_k(x) = \prod_{\substack{i=0 ,\ i \neq k}}^{n} \frac{x - x_i}{x_k - x_i}
$$
本质上是一个分式，当 $x=x_k$ 时，$l_k(x) = 1$，这一操作实现了离散数据的连续化。按照对应下标的函数值加权求和可以得到：
$$
L(x) = \sum_{k=0}^ny_kl_k(x)
$$

---

# 实现

```python
from scipy.interpolate import interp1d

x0 = [1, 2, 3, 4, 5]
y0 = [1.6, 1.8, 3.2, 5.9, 6.8]

x = np.arange(1, 5, 1 / 30)
# linear 是线性插值，返回 lambda 表达式
f1 = interp1d(x0, y0, "linear")
y1 = f1(x)
# cubic 是三次样条插值，返回 lambda 表达式
f2 = interp1d(x0, y0, "cubic")
y2 = f2(x)
print(y1, "\n")
print(y2)
```

```shell
[1.6        1.60666667 1.61333333 1.62       1.62666667 1.63333333
 1.64       1.64666667 1.65333333 1.66       1.66666667 1.67333333
 1.68       1.68666667 1.69333333 1.7        1.70666667 1.71333333
 1.72       1.72666667 1.73333333 1.74       1.74666667 1.75333333
 1.76       1.76666667 1.77333333 1.78       1.78666667 1.79333333
 1.8        1.84666667 1.89333333 1.94       1.98666667 2.03333333
 2.08       2.12666667 2.17333333 2.22       2.26666667 2.31333333
 2.36       2.40666667 2.45333333 2.5        2.54666667 2.59333333
 2.64       2.68666667 2.73333333 2.78       2.82666667 2.87333333
 2.92       2.96666667 3.01333333 3.06       3.10666667 3.15333333
 3.2        3.29       3.38       3.47       3.56       3.65
 3.74       3.83       3.92       4.01       4.1        4.19
 4.28       4.37       4.46       4.55       4.64       4.73
 4.82       4.91       5.         5.09       5.18       5.27
 5.36       5.45       5.54       5.63       5.72       5.81
 5.9        5.93       5.96       5.99       6.02       6.05
 6.08       6.11       6.14       6.17       6.2        6.23
 6.26       6.29       6.32       6.35       6.38       6.41
 6.44       6.47       6.5        6.53       6.56       6.59
 6.62       6.65       6.68       6.71       6.74       6.77      ] 

[1.6        1.59683889 1.59404444 1.59165    1.58968889 1.58819444
 1.5872     1.58673889 1.58684444 1.58755    1.58888889 1.59089444
 1.5936     1.59703889 1.60124444 1.60625    1.61208889 1.61879444
 1.6264     1.63493889 1.64444444 1.65495    1.66648889 1.67909444
 1.6928     1.70763889 1.72364444 1.74085    1.75928889 1.77899444
 1.8        1.82233889 1.84604444 1.87115    1.89768889 1.92569444
 1.9552     1.98623889 2.01884444 2.05305    2.08888889 2.12639444
 2.1656     2.20653889 2.24924444 2.29375    2.34008889 2.38829444
 2.4384     2.49043889 2.54444444 2.60045    2.65848889 2.71859444
 2.7808     2.84513889 2.91164444 2.98035    3.05128889 3.12449444
 3.2        3.27780926 3.35780741 3.43985    3.52379259 3.60949074
 3.6968     3.78557593 3.87567407 3.96695    4.05925926 4.15245741
 4.2464     4.34094259 4.43594074 4.53125    4.62672593 4.72222407
 4.8176     4.91270926 5.00740741 5.10155    5.19499259 5.28759074
 5.3792     5.46967593 5.55887407 5.64665    5.73285926 5.81735741
 5.9        5.98064259 6.05914074 6.13535    6.20912593 6.28032407
 6.3488     6.41440926 6.47700741 6.53645    6.59259259 6.64529074
 6.6944     6.73977593 6.78127407 6.81875    6.85205926 6.88105741
 6.9056     6.92554259 6.94074074 6.95105    6.95632593 6.95642407
 6.9512     6.94050926 6.92420741 6.90215    6.87419259 6.84019074]
```

```python
import numpy as np

def lagrange_interp(x, y, xi):
    """
    使用拉格朗日插值进行函数逼近。

    参数：
        x: list 或 numpy 数组，已知点的横坐标列表。
        y: list 或 numpy 数组，已知点的纵坐标列表。
        xi: list 或 numpy 数组，要进行插值的横坐标列表。

    返回值：
        numpy 数组，对应于输入的 xi 值的拉格朗日插值结果。
    """

    n = len(x)  # 已知点个数
    m = len(xi)  # 插值点个数
    yi = np.zeros(m)  # 初始化插值结果数组

    for k in range(m):  # 遍历插值点
        s = 0
        for i in range(n):  # 遍历已知点
            t = y[i]  # 初始化 t
            for j in range(n):  # 遍历已知点，计算插值项
                if i != j:
                    t *= (xi[k] - x[j]) / (x[i] - x[j])
            s += t  # 累加插值项
        yi[k] = s  # 存储插值结果
    
    return yi



y3 = lagrange_interp(x0, y0, x)
plt.plot(x0, y0, "r*")
plt.plot(x, y1, "b-", x, y2, "y-", x, y3, "r-")
plt.show()
```

