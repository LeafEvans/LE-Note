# Person 校正卡方检验

## 基本思想

卡方检验（_Chi-square test_）是一种基于卡方（$\chi^2$）分布的假设检验方法，用于检验观察频数与期望频数之间的差异是否显著。其基本假设 $H_0$ 是：**观察频数与期望频数之间没有显著差异**。

#### 基本步骤

1. **假设**：

   - **原假设 $H_0$**：观察频数与期望频数没有显著差异，即观察值与理论值的偏离符合期望。
   - **备择假设 $H_1$**：观察频数与期望频数之间存在显著差异。

2. **计算卡方统计量**：

   - 假设原假设 $H_0$ 成立，根据观察值和期望值计算卡方统计量 \($\chi^2$)。它衡量了观察频数与期望频数之间的偏离程度。
   - 公式如下：
     $$
     \chi^2 = \sum_{i=1}^k \frac{(A_i - E_i)^2}{E_i}
     $$
     其中：
     - $A_i$ 是第 $i$ 类别的观察频数。
     - $E_i$ 是第 $i$ 类别的期望频数。
     - $k$ 是类别总数。

3. **确定显著性**：

   - 根据计算得到的 $\chi^2$ 值和自由度（$\text{df}$），查找卡方分布表，确定 $p$ 值。
   - **$p$ 值** 是在 $H_0$ 成立的情况下，获得当前卡方统计量或更极端统计量的概率。
     - 如果 $p$ 值很小（通常小于显著性水平 $\alpha$，如 0.05），说明观察频数与期望频数之间的偏离程度显著，拒绝原假设，表示数据之间有显著差异。
     - 如果 $p$ 值较大，则不能拒绝原假设，说明观察频数与期望频数之间的偏离在可接受范围内，数据与理论假设之间无显著差异。

#### 计算公式

- 卡方统计量的计算公式：
  $$
  \chi^2 = \sum_{i=1}^k \frac{(A_i - np_i)^2}{np_i}
  $$
  其中：
  - $n$ 是总样本量。
  - $p_i$ 是第 $i$ 类别的理论概率。

该公式通过比较观察频数和期望频数的差异来衡量数据是否符合预期的理论分布。

## 实际案例

### 案例一：文理分科态度的显著性检验

**背景**：

在一个中学中，随机抽取了两个班级，分别调查他们对文理分科的态度。调查结果如下：

| 班级 | 赞成 | 反对 |
| :--: | :--: | :--: |
| 甲班 |  37  |  27  |
| 乙班 |  39  |  21  |

我们想知道这两个班级对文理分科的态度是否存在显著差异。为了验证这一点，我们使用卡方检验（Chi-Square Test）。

**步骤**：

1. **构建观测数据表格**：
   我们将数据整理成一个 2x2 的列联表（contingency table）：

   ```plaintext
   | 班级 | 赞成 | 反对 |
   | ---- | ---- | ---- |
   | 甲班 |  37  |  27  |
   | 乙班 |  39  |  21  |
   ```

2. **执行卡方检验**：

   使用 `scipy.stats` 模块中的 `chi2_contingency` 函数对数据进行卡方检验。代码如下：

   ```python
   from scipy.stats import chi2_contingency
   import numpy as np

   kf_data = np.array([[37, 27], [39, 21]])
   kf = chi2_contingency(kf_data)
   print('chisq-statistic=%.4f, p-value=%.4f, df=%i expected_frep=%s' % kf)
   ```

   这段代码会输出四个值：

   - `chisq-statistic`：卡方统计量
   - `p-value`：p 值
   - `df`：自由度
   - `expected_frep`：期望频数矩阵

3. **解释结果**：

   - **卡方统计量（_chisq-statistic_）**：表示观察频数与期望频数之间的偏离程度。数值越大，说明观察频数与期望频数的偏离越大。
   - **p 值**：衡量在原假设 \(H_0\) 成立的情况下，观察到当前统计量或更极端统计量的概率。p 值越小，说明偏离程度越显著。
   - **自由度（_df_）**：卡方分布的自由度，计算方法为（行数 - 1）\*（列数 - 1）。

   在这个例子中，计算得到的 p 值为 0.5243，大于显著性水平 0.05。这意味着我们不能拒绝原假设，认为两个班级对文理分科的态度没有显著差异。

### 案例二：死亡年龄与居住地、性别的关系检验

**背景**：

我们想调查死亡年龄与居住地（农村/城市）以及性别（男性/女性）之间是否存在关系。数据如下：

| 年龄段 | 农村男性 | 农村女性 | 城市男性 | 城市女性 |
| ------ | -------- | -------- | -------- | -------- |
| 50-54  | 11.7%    | 8.7%     | 15.4%    | 8.4%     |
| 55-59  | 18.1%    | 11.7%    | 24.3%    | 13.6%    |
| 60-64  | 26.9%    | 20.3%    | 37.0%    | 19.3%    |
| 65-69  | 41.0%    | 30.9%    | 54.6%    | 35.1%    |
| 70-74  | 66.0%    | 54.3%    | 71.1%    | 50.0%    |

我们使用卡方检验来检查死亡年龄与居住地、性别是否存在显著关系。

**步骤**：

1. **构建观测数据表格**：
   将数据整理成一个 5x4 的列联表：

   ```plaintext
   | 年龄段 | 农村男性 | 农村女性 | 城市男性 | 城市女性 |
   | ----- | -------- | -------- | -------- | -------- |
   | 50-54 | 11.7%    | 8.7%     | 15.4%    | 8.4%     |
   | 55-59 | 18.1%    | 11.7%    | 24.3%    | 13.6%    |
   | 60-64 | 26.9%    | 20.3%    | 37.0%    | 19.3%    |
   | 65-69 | 41.0%    | 30.9%    | 54.6%    | 35.1%    |
   | 70-74 | 66.0%    | 54.3%    | 71.1%    | 50.0%    |
   ```

2. **执行卡方检验**：

   使用 `scipy.stats` 模块中的 `chi2_contingency` 函数对数据进行卡方检验。代码如下：

   ```python
   from scipy.stats import chi2_contingency
   import numpy as np

   kf_data = np.array([[11.7, 8.7, 15.4, 8.4], [18.1, 11.7, 24.3, 13.6],
                       [26.9, 20.3, 37.0, 19.3], [41.0, 30.9, 54.6, 35.1],
                       [66.0, 54.3, 71.1, 50.0]])

   kf = chi2_contingency(kf_data)
   print('chisq-statistic=%.4f, p-value=%.4f, df=%i expected_frep=%s' % kf)
   ```

   这段代码会输出四个值：

   - `chisq-statistic`：卡方统计量
   - `p-value`：p 值
   - `df`：自由度
   - `expected_frep`：期望频数矩阵

3. **解释结果**：

   - **卡方统计量（_chisq-statistic_）**：表示观察频数与期望频数之间的偏离程度。
   - **p 值**：在原假设 \(H_0\) 成立的情况下，观察到当前统计量或更极端统计量的概率。p 值越小，说明偏离程度越显著。
   - **自由度（_df_）**：卡方分布的自由度，计算方法为（行数 - 1）\*（列数 - 1）。

   在这个例子中，计算得到的 p 值为 0.9961，大于显著性水平 0.05。这意味着我们不能拒绝原假设，认为死亡年龄与居住地、性别之间没有显著差异。

---

# Yates 校正卡方检验

## 作用

卡方检验主要是比较定类变量与定类变量之间的差异性分析。当用皮尔森卡方检验做独立性检验时，若任何一个字段的期望次数小于 5，会使“近似与卡方分配”的假设不可信，统计值会系统性地偏高，导致过度地拒绝虚无假设。此时可以做叶氏连续性校正检验。

**校正的目的**：在小样本情况下，降低将离散型频数数据近似到连续性卡方统计量的过程中的误差。

## 输入输出描述

**输入**：一个定类变量 _X_（如班级字段，包括 A、B）与定类变量 Y（如 A 班级 28 名学生与 B 班级 14 名学生的成绩）。

**输出**：模型输出的检验结果，如 A 与 B 班级的学生存在、不存在显著性差异。
